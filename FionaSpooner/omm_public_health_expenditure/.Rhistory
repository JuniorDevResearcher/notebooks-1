}
countries <- read.csv("data/country_names_country_standardized.csv") %>% distinct()
oecd_members <- c("Australia", "Austria", "Belgium", "Canada", "Chile", "Colombia", "Costa Rica", "Czechia", "Denmark", "Estonia", "Finland", "France", "Germany", "Greece","Hungary", "Iceland", "Ireland", "Israel", "Italy", "Japan", "South Korea", "Latvia", "Lithuania", "Luxembourg", "Mexico", "Netherlands", "New Zealand", "Norway", "Poland", "Portugal", "Slovakia", "Spain", "Sweden", "Switzerland", "Turkey", "United Kingdom", "United States")
oecd <- read.csv(oecd_stat_fp) %>% filter(SUBJECT == 'COMPULSORY' & MEASURE == 'PC_GDP') %>%
select(entity = LOCATION, year = TIME,value = Value ) %>%
mutate(source = 'oecd_stat')%>%
left_join(., countries, by = c('entity'= 'Country')) %>%
select(entity = Our.World.In.Data.Name, year, value, source)%>%
# filter(entity %in%oecd_members) %>%
group_by(entity) %>%
complete(year = full_seq(min(year):max(year), 1))
ggplot()+
geom_line(data =oecd, aes(x = year, y = value, group = interaction(entity)))+
labs(x = "Year", y= "Public Health Expenditure (%GDP)")+
facet_wrap(.~entity)+
scale_x_continuous(breaks=seq(1970, 2020, 25))+
theme_bw()
oecd_93 <- read.csv("data/OECD 1993.csv") %>%
pivot_longer(starts_with('X')) %>%
mutate(entity = year, year = as.numeric(gsub("X","",name)), source = 'oecd_93') %>%
left_join(., countries, by = c('entity'= 'Country')) %>%
select(entity = Our.World.In.Data.Name, year, value, source)%>%
#filter(entity %in% oecd_members) %>%
filter(entity %in% oecd$entity)  %>%
group_by(entity) %>%
complete(year = full_seq(min(year):max(year), 1))
ggplot()+
geom_line(data =oecd_93, aes(x = year, y = value, group = interaction(entity)))+
labs(x = "Year", y= "Public Health Expenditure (%GDP)")+
facet_wrap(.~entity)+
scale_x_continuous(breaks=seq(1960, 1990, 15))+
theme_bw()
lindert <- read.csv("data/lindert_1880_1930.csv") %>%
left_join(., countries, by = c('entity'= 'Country')) %>%
mutate(source = 'Lindert') %>%
select(entity = Our.World.In.Data.Name, year, value = public_expenditure_on_health, source)%>%
select(entity,year,value, source )
ggplot()+
geom_line(data =lindert, aes(x = year, y = value, group = interaction(entity)))+
labs(x = "Year", y= "Public Health Expenditure (%GDP)")+
facet_wrap(.~entity)+
scale_x_continuous(breaks=seq(1880, 1930, 25))+
theme_bw()
oecd <- oecd %>% group_by(entity) %>%
mutate(value = na.approx(value, na.rm = FALSE)) %>%
ungroup()
oecd_93 <- oecd_93 %>% group_by(entity) %>%
mutate(value = na.approx(value, na.rm = FALSE)) %>%
ungroup()
oecd_both<- rbind(oecd, oecd_93)
oecd_both$source[is.na(oecd_both$source)] <- 'OWID'
ggplot()+
geom_line(data =oecd_both, aes(x = year, y = value, group = interaction(source,entity), colour = source), size = 1)+
scale_x_continuous(breaks=seq(1960, 2020, 30))+
facet_wrap(.~ entity)
roc_df<- oecd %>%
select(entity, year, value) %>%
group_by(entity) %>%
arrange(entity,year) %>%
mutate(time_m1 = lag(value, n = 1L), br_roc = time_m1/value, source = 'oecd_stat') %>%
select(entity, year = year, br_roc, source) %>%
ungroup() %>%
filter(complete.cases(.))
roc_df %>% arrange(entity, year) %>% filter(entity == 'Switzerland')
oecd_93_roc <- oecd_93 %>%
select(entity, year, value) %>%
#filter(between(year, 1960, 1970)) %>%
group_by(entity) %>%
mutate(time_m1 = lag(value, n = 1L), br_roc = time_m1/value, source = 'oecd_93') %>%
select(entity, year, br_roc, source) %>%
ungroup() %>%
filter(complete.cases(.))
oecd_93_roc
roc_both <- rbind(oecd_93_roc, roc_df)
roc_both <- roc_both %>%
left_join(., countries, by = c('entity'= 'Country')) %>%
select(entity = Our.World.In.Data.Name, year, br_roc, source)
roc_both <- roc_both %>%
group_by(entity, year) %>%
add_count() %>%
ungroup()
roc_sel <- roc_both[-which(roc_both$n >1 & roc_both$source == 'oecd_93'),]
roc_sel %>% filter(entity == 'France')
roc_int <- roc_sel %>%
group_by(entity) %>%
complete(year = full_seq(min(year):max(year), 1))%>%
mutate(br_roc = na.approx(br_roc, na.rm = FALSE)) %>%
ungroup()
roc_int %>% filter(entity == 'Switzerland')
roc_int$source[is.na(roc_int$source)] <- 'OWID'
oecd <- oecd %>%
left_join(., countries, by = c('entity'= 'Country')) %>%
select(entity = Our.World.In.Data.Name, year, value, source)
oecd_out <- oecd %>%
select(entity, year, value)
oecd_loop <- NULL
entities <- unique(oecd_out$entity)
for (entity_sel in entities) {
oecd_sel <- oecd_out %>%
filter(entity == entity_sel)
start_reg_year <- min(oecd_sel$year)
min_roc_year <-
roc_int %>% group_by(entity) %>%  filter(entity == entity_sel, year == min(year)) %>% ungroup() %>% select(year)  %>% pull()
years <- start_reg_year:min_roc_year
if (min_roc_year <= start_reg_year) {
for (year_sel in years) {
roc_yr <- roc_int %>% filter(year == year_sel & entity == entity_sel)
oecd_new <- oecd_sel %>% filter(year == year_sel) %>%
mutate(value = value * roc_yr$br_roc, year = year_sel - 1) %>%
select(entity, year, value)
oecd_sel <- rbind(oecd_sel, oecd_new)
}
}
oecd_loop <- rbind(oecd_loop, oecd_sel)
}
oecd_out <- oecd %>%
select(entity, year, value)
oecd_loop <- NULL
entities <- unique(oecd_out$entity)
entity_sel
entities <- unique(oecd_out$entity)
entities
read.csv("data/OECD 1993.csv") %>%
pivot_longer(starts_with('X')) %>%
mutate(entity = year, year = as.numeric(gsub("X","",name)), source = 'oecd_93') %>%
left_join(., countries, by = c('entity'= 'Country'))
read.csv("data/OECD 1993.csv") %>%
pivot_longer(starts_with('X')) %>%
mutate(entity = year, year = as.numeric(gsub("X","",name)), source = 'oecd_93') %>%
left_join(., countries, by = c('entity'= 'Country')) %>% filter(is.na(entity))
View(read.csv("data/OECD 1993.csv") %>%
pivot_longer(starts_with('X')) %>%
mutate(entity = year, year = as.numeric(gsub("X","",name)), source = 'oecd_93') %>%
left_join(., countries, by = c('entity'= 'Country')))
read.csv(oecd_stat_fp) %>% filter(SUBJECT == 'COMPULSORY' & MEASURE == 'PC_GDP') %>%
select(entity = LOCATION, year = TIME,value = Value ) %>%
mutate(source = 'oecd_stat')%>%
left_join(., countries, by = c('entity'= 'Country')) %>% select(entity, Our.World.In.Data.Name) %>% distinct()
oecd <- read.csv(oecd_stat_fp) %>% filter(SUBJECT == 'COMPULSORY' & MEASURE == 'PC_GDP') %>%
select(entity = LOCATION, year = TIME,value = Value ) %>%
mutate(source = 'oecd_stat')%>%
left_join(., countries, by = c('entity'= 'Country')) %>%
select(entity = Our.World.In.Data.Name, year, value, source)%>%
# filter(entity %in%oecd_members) %>%
group_by(entity) %>%
complete(year = full_seq(min(year):max(year), 1))
ggplot()+
geom_line(data =oecd, aes(x = year, y = value, group = interaction(entity)))+
labs(x = "Year", y= "Public Health Expenditure (%GDP)")+
facet_wrap(.~entity)+
scale_x_continuous(breaks=seq(1970, 2020, 25))+
theme_bw()
View(oecd)
oecd_93 <- read.csv("data/OECD 1993.csv") %>%
pivot_longer(starts_with('X')) %>%
mutate(entity = year, year = as.numeric(gsub("X","",name)), source = 'oecd_93') %>%
left_join(., countries, by = c('entity'= 'Country')) %>%
select(entity = Our.World.In.Data.Name, year, value, source)%>%
#filter(entity %in% oecd_members) %>%
filter(entity %in% oecd$entity)  %>%
group_by(entity) %>%
complete(year = full_seq(min(year):max(year), 1))
ggplot()+
geom_line(data =oecd_93, aes(x = year, y = value, group = interaction(entity)))+
labs(x = "Year", y= "Public Health Expenditure (%GDP)")+
facet_wrap(.~entity)+
scale_x_continuous(breaks=seq(1960, 1990, 15))+
theme_bw()
lindert <- read.csv("data/lindert_1880_1930.csv") %>%
left_join(., countries, by = c('entity'= 'Country')) %>%
mutate(source = 'Lindert') %>%
select(entity = Our.World.In.Data.Name, year, value = public_expenditure_on_health, source)%>%
select(entity,year,value, source )
ggplot()+
geom_line(data =lindert, aes(x = year, y = value, group = interaction(entity)))+
labs(x = "Year", y= "Public Health Expenditure (%GDP)")+
facet_wrap(.~entity)+
scale_x_continuous(breaks=seq(1880, 1930, 25))+
theme_bw()
oecd <- oecd %>% group_by(entity) %>%
mutate(value = na.approx(value, na.rm = FALSE)) %>%
ungroup()
oecd_93 <- oecd_93 %>% group_by(entity) %>%
mutate(value = na.approx(value, na.rm = FALSE)) %>%
ungroup()
oecd_both<- rbind(oecd, oecd_93)
oecd_both$source[is.na(oecd_both$source)] <- 'OWID'
ggplot()+
geom_line(data =oecd_both, aes(x = year, y = value, group = interaction(source,entity), colour = source), size = 1)+
scale_x_continuous(breaks=seq(1960, 2020, 30))+
facet_wrap(.~ entity)
View(oecd_both %>% select(entity) %>% distinct())
roc_df<- oecd %>%
select(entity, year, value) %>%
group_by(entity) %>%
arrange(entity,year) %>%
mutate(time_m1 = lag(value, n = 1L), br_roc = time_m1/value, source = 'oecd_stat') %>%
select(entity, year = year, br_roc, source) %>%
ungroup() %>%
filter(complete.cases(.))
roc_df %>% arrange(entity, year) %>% filter(entity == 'Switzerland')
oecd_93_roc <- oecd_93 %>%
select(entity, year, value) %>%
#filter(between(year, 1960, 1970)) %>%
group_by(entity) %>%
mutate(time_m1 = lag(value, n = 1L), br_roc = time_m1/value, source = 'oecd_93') %>%
select(entity, year, br_roc, source) %>%
ungroup() %>%
filter(complete.cases(.))
oecd_93_roc
roc_both <- rbind(oecd_93_roc, roc_df)
roc_both <- roc_both %>%
left_join(., countries, by = c('entity'= 'Country')) %>%
select(entity = Our.World.In.Data.Name, year, br_roc, source)
roc_both <- roc_both %>%
group_by(entity, year) %>%
add_count() %>%
ungroup()
roc_sel <- roc_both[-which(roc_both$n >1 & roc_both$source == 'oecd_93'),]
roc_sel %>% filter(entity == 'France')
View(roc_both %>% select(entity) %>% distinct())
roc_int <- roc_sel %>%
group_by(entity) %>%
complete(year = full_seq(min(year):max(year), 1))%>%
mutate(br_roc = na.approx(br_roc, na.rm = FALSE)) %>%
ungroup()
roc_int %>% filter(entity == 'Switzerland')
roc_int$source[is.na(roc_int$source)] <- 'OWID'
oecd <- oecd %>%
left_join(., countries, by = c('entity'= 'Country')) %>%
select(entity = Our.World.In.Data.Name, year, value, source)
View(oecd)
oecd_out <- oecd %>%
select(entity, year, value)
oecd_loop <- NULL
entities <- unique(oecd_out$entity)
for (entity_sel in entities) {
oecd_sel <- oecd_out %>%
filter(entity == entity_sel)
start_reg_year <- min(oecd_sel$year)
min_roc_year <-
roc_int %>% group_by(entity) %>%  filter(entity == entity_sel, year == min(year)) %>% ungroup() %>% select(year)  %>% pull()
print(entity_sel)
years <- start_reg_year:min_roc_year
if (min_roc_year <= start_reg_year) {
for (year_sel in years) {
roc_yr <- roc_int %>% filter(year == year_sel & entity == entity_sel)
oecd_new <- oecd_sel %>% filter(year == year_sel) %>%
mutate(value = value * roc_yr$br_roc, year = year_sel - 1) %>%
select(entity, year, value)
oecd_sel <- rbind(oecd_sel, oecd_new)
}
}
oecd_loop <- rbind(oecd_loop, oecd_sel)
}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
library(jsonlite)
library(dplyr)
library(ggplot2)
library(janitor)
library(tidyr)
library(zoo)
year <- format(Sys.Date(),"%Y")
oecd_stat_fp <- paste0("data/oecd_stat_",year,".csv")
if (!file.exists(oecd_stat_fp)){
download.file('https://stats.oecd.org/sdmx-json/data/DP_LIVE/.HEALTHEXP.../OECD?contentType=csv&detail=code&separator=comma&csv-lang=en', oecd_stat_fp )
}
countries <- read.csv("data/country_names_country_standardized.csv") %>% distinct()
oecd_members <- c("Australia", "Austria", "Belgium", "Canada", "Chile", "Colombia", "Costa Rica", "Czechia", "Denmark", "Estonia", "Finland", "France", "Germany", "Greece","Hungary", "Iceland", "Ireland", "Israel", "Italy", "Japan", "South Korea", "Latvia", "Lithuania", "Luxembourg", "Mexico", "Netherlands", "New Zealand", "Norway", "Poland", "Portugal", "Slovakia", "Spain", "Sweden", "Switzerland", "Turkey", "United Kingdom", "United States")
oecd <- read.csv(oecd_stat_fp) %>% filter(SUBJECT == 'COMPULSORY' & MEASURE == 'PC_GDP') %>%
select(entity = LOCATION, year = TIME,value = Value ) %>%
mutate(source = 'oecd_stat')%>%
left_join(., countries, by = c('entity'= 'Country')) %>%
select(entity = Our.World.In.Data.Name, year, value, source)%>%
# filter(entity %in%oecd_members) %>%
group_by(entity) %>%
complete(year = full_seq(min(year):max(year), 1))
ggplot()+
geom_line(data =oecd, aes(x = year, y = value, group = interaction(entity)))+
labs(x = "Year", y= "Public Health Expenditure (%GDP)")+
facet_wrap(.~entity)+
scale_x_continuous(breaks=seq(1970, 2020, 25))+
theme_bw()
oecd_93 <- read.csv("data/OECD 1993.csv") %>%
pivot_longer(starts_with('X')) %>%
mutate(entity = year, year = as.numeric(gsub("X","",name)), source = 'oecd_93') %>%
left_join(., countries, by = c('entity'= 'Country')) %>%
select(entity = Our.World.In.Data.Name, year, value, source)%>%
#filter(entity %in% oecd_members) %>%
filter(entity %in% oecd$entity)  %>%
group_by(entity) %>%
complete(year = full_seq(min(year):max(year), 1))
ggplot()+
geom_line(data =oecd_93, aes(x = year, y = value, group = interaction(entity)))+
labs(x = "Year", y= "Public Health Expenditure (%GDP)")+
facet_wrap(.~entity)+
scale_x_continuous(breaks=seq(1960, 1990, 15))+
theme_bw()
lindert <- read.csv("data/lindert_1880_1930.csv") %>%
left_join(., countries, by = c('entity'= 'Country')) %>%
mutate(source = 'Lindert') %>%
select(entity = Our.World.In.Data.Name, year, value = public_expenditure_on_health, source)%>%
select(entity,year,value, source )
ggplot()+
geom_line(data =lindert, aes(x = year, y = value, group = interaction(entity)))+
labs(x = "Year", y= "Public Health Expenditure (%GDP)")+
facet_wrap(.~entity)+
scale_x_continuous(breaks=seq(1880, 1930, 25))+
theme_bw()
oecd <- oecd %>% group_by(entity) %>%
mutate(value = na.approx(value, na.rm = FALSE)) %>%
ungroup()
oecd_93 <- oecd_93 %>% group_by(entity) %>%
mutate(value = na.approx(value, na.rm = FALSE)) %>%
ungroup()
oecd_both<- rbind(oecd, oecd_93)
oecd_both$source[is.na(oecd_both$source)] <- 'OWID'
ggplot()+
geom_line(data =oecd_both, aes(x = year, y = value, group = interaction(source,entity), colour = source), size = 1)+
scale_x_continuous(breaks=seq(1960, 2020, 30))+
facet_wrap(.~ entity)
roc_df<- oecd %>%
select(entity, year, value) %>%
group_by(entity) %>%
arrange(entity,year) %>%
mutate(time_m1 = lag(value, n = 1L), br_roc = time_m1/value, source = 'oecd_stat') %>%
select(entity, year = year, br_roc, source) %>%
ungroup() %>%
filter(complete.cases(.))
roc_df %>% arrange(entity, year) %>% filter(entity == 'Switzerland')
oecd_93_roc <- oecd_93 %>%
select(entity, year, value) %>%
#filter(between(year, 1960, 1970)) %>%
group_by(entity) %>%
mutate(time_m1 = lag(value, n = 1L), br_roc = time_m1/value, source = 'oecd_93') %>%
select(entity, year, br_roc, source) %>%
ungroup() %>%
filter(complete.cases(.))
oecd_93_roc
roc_both <- rbind(oecd_93_roc, roc_df)
roc_both <- roc_both %>%
left_join(., countries, by = c('entity'= 'Country')) %>%
select(entity = Our.World.In.Data.Name, year, br_roc, source)
roc_both <- roc_both %>%
group_by(entity, year) %>%
add_count() %>%
ungroup()
roc_sel <- roc_both[-which(roc_both$n >1 & roc_both$source == 'oecd_93'),]
roc_sel %>% filter(entity == 'France')
roc_int <- roc_sel %>%
group_by(entity) %>%
complete(year = full_seq(min(year):max(year), 1))%>%
mutate(br_roc = na.approx(br_roc, na.rm = FALSE)) %>%
ungroup()
roc_int %>% filter(entity == 'Switzerland')
roc_int$source[is.na(roc_int$source)] <- 'OWID'
oecd_out <- oecd %>%
select(entity, year, value)
oecd_loop <- NULL
entities <- unique(oecd_out$entity)
for (entity_sel in entities) {
oecd_sel <- oecd_out %>%
filter(entity == entity_sel)
start_reg_year <- min(oecd_sel$year)
min_roc_year <-
roc_int %>% group_by(entity) %>%  filter(entity == entity_sel, year == min(year)) %>% ungroup() %>% select(year)  %>% pull()
print(entity_sel)
years <- start_reg_year:min_roc_year
if (min_roc_year <= start_reg_year) {
for (year_sel in years) {
roc_yr <- roc_int %>% filter(year == year_sel & entity == entity_sel)
oecd_new <- oecd_sel %>% filter(year == year_sel) %>%
mutate(value = value * roc_yr$br_roc, year = year_sel - 1) %>%
select(entity, year, value)
oecd_sel <- rbind(oecd_sel, oecd_new)
}
}
oecd_loop <- rbind(oecd_loop, oecd_sel)
}
entities <- unique(oecd_out$entity)
entities
oecd_out <- oecd %>%
select(entity, year, value)
oecd_loop <- NULL
entities <- unique(oecd_out$entity)
for (entity_sel in entities) {
oecd_sel <- oecd_out %>%
filter(entity == entity_sel)
start_reg_year <- min(oecd_sel$year)
min_roc_year <-
roc_int %>% group_by(entity) %>%  filter(entity == entity_sel, year == min(year)) %>% ungroup() %>% select(year)  %>% pull()
print(entity_sel)
years <- start_reg_year:min_roc_year
if (min_roc_year <= start_reg_year) {
for (year_sel in years) {
roc_yr <- roc_int %>% filter(year == year_sel & entity == entity_sel)
oecd_new <- oecd_sel %>% filter(year == year_sel) %>%
mutate(value = value * roc_yr$br_roc, year = year_sel - 1) %>%
select(entity, year, value)
oecd_sel <- rbind(oecd_sel, oecd_new)
}
}
oecd_loop <- rbind(oecd_loop, oecd_sel)
}
entity_sel ="Bulgaria"
oecd_sel <- oecd_out %>%
filter(entity == entity_sel)
oecd_sel
oecd_sel
start_reg_year <- min(oecd_sel$year)
start_reg_year
min_roc_year <-
roc_int %>% group_by(entity) %>%  filter(entity == entity_sel, year == min(year)) %>% ungroup() %>% select(year)  %>% pull()
min_roc_year
print(entity_sel)
years <- start_reg_year:min_roc_year
min_roc_year <= start_reg_year
(min_roc_year <= start_reg_year)
oecd_out <- oecd %>%
select(entity, year, value)
oecd_loop <- NULL
entities <- unique(oecd_out$entity)
for (entity_sel in entities) {
oecd_sel <- oecd_out %>%
filter(entity == entity_sel)
start_reg_year <- min(oecd_sel$year)
min_roc_year <-
roc_int %>% group_by(entity) %>%  filter(entity == entity_sel, year == min(year)) %>% ungroup() %>% select(year)  %>% pull()
print(entity_sel)
if (min_roc_year <= start_reg_year) {
years <- start_reg_year:min_roc_year
for (year_sel in years) {
roc_yr <- roc_int %>% filter(year == year_sel & entity == entity_sel)
oecd_new <- oecd_sel %>% filter(year == year_sel) %>%
mutate(value = value * roc_yr$br_roc, year = year_sel - 1) %>%
select(entity, year, value)
oecd_sel <- rbind(oecd_sel, oecd_new)
}
}
oecd_loop <- rbind(oecd_loop, oecd_sel)
}
oecd_out <- oecd %>%
select(entity, year, value)
oecd_loop <- NULL
entities <- unique(oecd_out$entity)
for (entity_sel in entities) {
oecd_sel <- oecd_out %>%
filter(entity == entity_sel)
start_reg_year <- min(oecd_sel$year)
min_roc_year <-
roc_int %>% group_by(entity) %>%  filter(entity == entity_sel, year == min(year)) %>% ungroup() %>% select(year)  %>% pull()
print(entity_sel)
if ( length(min_roc_year)  == 1& min_roc_year <= start_reg_year) {
years <- start_reg_year:min_roc_year
for (year_sel in years) {
roc_yr <- roc_int %>% filter(year == year_sel & entity == entity_sel)
oecd_new <- oecd_sel %>% filter(year == year_sel) %>%
mutate(value = value * roc_yr$br_roc, year = year_sel - 1) %>%
select(entity, year, value)
oecd_sel <- rbind(oecd_sel, oecd_new)
}
}
oecd_loop <- rbind(oecd_loop, oecd_sel)
}
length(min_roc_year)
min_roc_year
as.numeric(min_roc_year)
1.99/1.58
2.26/1.79
write.csv(full_owid,paste0('data/OMM_public_health_expenditure_',year,'.csv'), row.names = FALSE)
roc_df<- oecd %>%
select(entity, year, value) %>%
group_by(entity) %>%
arrange(entity,year) %>%
mutate(time_m1 = lag(value, n = 1L), br_roc = time_m1/value, source = 'oecd_stat') %>%
#select(entity, year, br_roc, source) %>%
ungroup() %>%
filter(complete.cases(.))
head(roc_df)
oecd_93_roc <- oecd_93 %>%
select(entity, year, value) %>%
#filter(between(year, 1960, 1970)) %>%
group_by(entity) %>%
mutate(time_m1 = lag(value, n = 1L), br_roc = time_m1/value, source = 'oecd_93') %>%
#select(entity, year, br_roc, source) %>%
ungroup() %>%
filter(complete.cases(.))
head(roc_both)
oecd_93_roc <- oecd_93 %>%
select(entity, year, value) %>%
#filter(between(year, 1960, 1970)) %>%
group_by(entity) %>%
mutate(time_m1 = lag(value, n = 1L), br_roc = time_m1/value, source = 'oecd_93') %>%
#select(entity, year, br_roc, source) %>%
ungroup() %>%
filter(complete.cases(.))
roc_both <- rbind(oecd_93_roc, roc_df)
head(roc_both)
2.74 * 0.9379562
Plot the combined dataset to check it looks sensible:
oecd_both<- rbind(oecd, oecd_93)
oecd_both$source[is.na(oecd_both$source)] <- 'OWID'
ggplot()+
geom_line(data =oecd_both, aes(x = year, y = value, group = interaction(source,entity), colour = source), size = 1)+
scale_x_continuous(breaks=seq(1960, 2020, 30))+
facet_wrap(.~ entity)
oecd_93_roc <- oecd_93 %>%
select(entity, year, value) %>%
group_by(entity) %>%
mutate(time_m1 = lag(value, n = 1L), br_roc = time_m1/value, source = 'oecd_93') %>%
ungroup() %>%
filter(complete.cases(.))
