---
title: "First look at the main data"
author: "Joe Hasell"
date: "25/04/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(RCurl)
library(knitr)
```


Pull in data from Michalis' folder in Github repo
```{r}
df <- read.csv("https://raw.githubusercontent.com/owid/notebooks/main/MichalisMoatsos/MainDataCountriesOnly.csv", row.names = 1, header = T, sep = ";", dec = ",")

```


* Can you add a $1 a day poverty line please.

* There are observations where the poverty share = -1.

See rough summary of poverty shares
```{r}
summary(df[ , grep("share.of.population.below.poverty.line", colnames(df))] )  


```

For instance:
```{r}
kable(head(df %>%
  filter(X.20.per.day...share.of.population.below.poverty.line < 0) %>%
    select(Entity, Year, X.20.per.day...share.of.population.below.poverty.line)))

```

* Relative poverty = 0 in some observations

```{r}
kable(head(df %>%
  filter(X.40..of.median.income...share.of.population.below.poverty.line ==0) %>%
    select(Entity, Year, X.40..of.median.income...share.of.population.below.poverty.line, Median, Median_estimated)))
```


* Missing values:

Count NA's by column and filter for count>0
```{r}
kable(data.frame(colSums(is.na(df))) %>%
  filter(colSums.is.na.df.. > 0))
```

  + Why are there some missing values for a very small number of relative poverty lines?
  + Povcal for some reason witholds a bunch of variables for loads of observations (2266 observations in your data it looks like). I've never really understood why. Is this also an issue in PIP? If so then I think the solution should be: use the direct output where available but fill in the NAs with the estimated value produced by us. (Not just for Median, but for all variables).

Belarus:  the difference between IsSurveyYear = TRUE and FALSE
```{r}
selected_countries<-  c("BLR")

# df of survey year only vs all year

all_years<- df %>%
  filter(Entity %in% selected_countries) %>%
  select(Entity, Year, X.1.9.per.day...total.number.of.people.below.poverty.line, datatype, IsSurveyYear) %>%
  mutate(which_years = "All years")

survey_years <- df %>%
  filter(Entity %in% selected_countries,
         IsSurveyYear == TRUE) %>%
  select(Entity, Year, X.1.9.per.day...total.number.of.people.below.poverty.line, datatype, IsSurveyYear) %>%
  mutate(which_years = "Survey years only")

df_compare<- rbind(all_years, survey_years)

df_compare %>%
  ggplot(aes(x = Year, y = X.1.9.per.day...total.number.of.people.below.poverty.line, colour = which_years)) + 
  geom_line()


```
